{% extends 'base.html' %}

{% set ERR_GENERAL_ID = 'ERR_GENERAL_ID' %}
{% set form_delete_id = 'form-delete' %}

{% block scripts scoped %}
    {{ super() }}
    <script>
        const ERR_GENERAL_ID = "{{ ERR_GENERAL_ID }}";
        const FORM_DELETE_ID = "{{ form_delete_id }}";
        const API_URL_FLASH = "{{ url_for('api_flash') }}";
    </script>
    <script src="{{ url_for('static', filename='scripts/forms.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/manage.js') }}"></script>
{% endblock %}


{% block content scoped %}
    {% block modal scoped %}
        <div id="modal-delete" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Delete Employee</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="{{ form_delete_id }}" action="{{ url_for('api_employee_delete') }}" method="post">
                            {{ form.hidden_tag() }}
                            {% for fieldname in ['replacement_id'] %}
                                {% with field = form|attr(fieldname) %}
                                    <p>
                                        {{ field.label(class='pb-0') }}<br>
                                        {% if field.description -%}
                                            <small>{{ field.description }}</small><br>
                                        {%- endif %}
                                        {{ field(size=10)}}<br>
                                        <span class="errors" for="{{ field.id }}">
                                            {% for error in field.errors %}
                                                <span>[{{ error }}]</span>
                                            {% endfor %}
                                        </span>
                                    </p>
                                {% endwith %}
                            {% endfor %}
                            <span class="errors" for="{{ ERR_GENERAL_ID }}"></span>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" form="form-delete" class="btn btn-primary">Confirm</button>
                    </div>
                </div>
            </div>
        </div>
    {% endblock %}

    <a href="{{ url_for('employee') }}">Add new employee</a>
    <h1>Employee Table</h1>
    {% block table %}
        {% if employees %}
            {% with keys = ['id', 'full_name', 'position', 'salary', 'hire_date', 'supervisor', 'actions'] %}
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            {% for key in keys %}
                                <th scope=col>{{ key|replace('_',' ')|trim|capitalize }} </th>
                            {% endfor %}
                        <tr>
                    </thead>
                    <tbody>
                        {% for employee in employees %}
                            <tr>
                                {% for key in keys[:-1] %}
                                    <td>{{ employee|attr(key) }}</td>
                                {% endfor %}
                                <td>
                                    <a href="{{ url_for('employee', id=employee.id) }}">edit</a>
                                    <a href="#" data-id={{ employee.id }} data-toggle="modal" data-target="#modal-delete" onclick="show_modal_delete({{ employee.id }});">delete</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                <table>
            {% endwith %}
        {% endif %}
    {% endblock %}
{% endblock %}
